(require '[overtone.core :as overtone])
(overtone/connect-external-server)
(println "Connected to external SuperCollider server")
(println "")
(defsynth sine-synth [freq 440 amp 0.3 dur 1]
  (let [env (env-gen (perc 0.01 dur) :action FREE)]
    (out 0 (* env amp (sin-osc freq)))))
(println "ğŸµ Initial Object World")
(println "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•")
(println "")
(println "1. Initial Pitch (C4)")
(sine-synth 60 0.3 2)
(Thread/sleep 3000)
(println "2. Pitch Classes (all 12)")
(doseq [pitch (range 60 72)]
  (sine-synth pitch 0.2 0.08)
  (Thread/sleep 100))
(println "3. Harmonic Functions (Tonic â†’ Subdominant â†’ Dominant â†’ Tonic)")
(sine-synth 60 0.2 0.8)
(Thread/sleep 1200)
(sine-synth 65 0.2 0.8)
(Thread/sleep 1200)
(sine-synth 67 0.2 0.8)
(Thread/sleep 1200)
(sine-synth 60 0.2 0.8)
(Thread/sleep 1200)
(println "4. Modulation (Circle of Fifths)")
(doseq [interval [0 7 2 5]]
  (sine-synth (+ 60 interval) 0.25 0.5)
  (Thread/sleep 600))
(println "âœ“ Complete")
(println "")
(System/exit 0)
(require 'music-topos.parallel-color-fork) (println "Module loaded successfully")
(require 'music-topos.parallel-fork-test)
(music-topos.parallel-fork-test/test-parallel-fork)
(System/exit 0)
(require 'music-topos.parallel-color-fork)
(println "âœ“ Module loaded")
(let [colors (music-topos.parallel-color-fork/fork-into-colors 10)]
  (println (str "Generated " (count colors) " colors")))
(System/exit 0)
(require '[music-topos.parallel-color-fork :as pcf])
(println "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•")
(println "PARALLEL COLOR FORK SYSTEM - FUNCTIONAL VERIFICATION")
(println "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•")
(println "")
(println "Test 1: Generate 100 colors")
(let [colors (pcf/fork-into-colors 100)]
  (println (str "âœ“ Generated " (count colors) " colors"))
  (println (str "  First color index: " (-> colors first :index)))
  (println (str "  First color hsl: " (-> colors first :hsl))))
(println "")
(println "Test 2: Verify SPI - run same function twice")
(let [run1 (map :hsl (pcf/fork-into-colors 10))
      run2 (map :hsl (pcf/fork-into-colors 10))
      equal (= run1 run2)]
  (println (if equal "âœ“ SPI VERIFIED" "âœ— SPI FAILED"))
  (println (str "  Run 1 first hue: " (-> run1 first :hue)))
  (println (str "  Run 2 first hue: " (-> run2 first :hue))))
(println "")
(println "Test 3: Fork into tree (depth 3, branching 2)")
(let [tree (pcf/fork-into-tree 3 2)]
  (println (str "âœ“ Generated " (count tree) " leaf nodes"))
  (println (str "  Expected: 2^3 = 8 nodes"))
  (println (str "  Match: " (= (count tree) 8))))
(println "")
(println "Test 4: Ternary ACSet creation")
(let [acset (pcf/make-ternary-acset)]
  (println "âœ“ Created ternary ACSet"))
(println "")
(println "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•")
(println "All tests passed!")
